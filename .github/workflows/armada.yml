name: Aramda

on:
  pull_request:

jobs:
  armada:
    name: Build Armada Scala client
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          path: armada
      - name: Install Scala and SBT
        env:
          SBT_VERSION: 1.10.7
          SCALA_VERSION: 2.13.15
        run: |
          curl -s -O https://downloads.lightbend.com/scala/${SCALA_VERSION}/scala-${SCALA_VERSION}.deb
          sudo apt install -y ./scala-${SCALA_VERSION}.deb
          curl -s -L -O https://github.com/sbt/sbt/releases/download/v${SBT_VERSION}/sbt-${SBT_VERSION}.tgz
          tar -xzvf ./sbt-${SBT_VERSION}.tgz
          echo "$PWD/sbt/bin" >> "${GITHUB_PATH}"
          curl -s -L -O https://github.com/magefile/mage/releases/download/v1.15.0/mage_1.15.0_Linux-64bit.tar.gz
          tar -xzvf ./mage_1.15.0_Linux-64bit.tar.gz mage
          sudo apt install -y protobuf-compiler
      - name: Build Armada Scala Client
        run: |
          cd armada
          ../mage buildScala
          cd client/scala/scala-armada-client
          sbt -Dsbt.io.implicit.relative.glob.conversion=allow publishM2

